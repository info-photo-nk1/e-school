ğŸ¯ è¨­è¨ˆã®æ ¸å¿ƒçš„ãªç‰¹å¾´
1. æ®µéšçš„AIå°å…¥æˆ¦ç•¥

Phase 1: AIæ©Ÿèƒ½ãªã—ã§åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰ï¼ˆå³åº§é–‹å§‹å¯èƒ½ï¼‰
Phase 2: Claude/Gemini APIçµ±åˆã«ã‚ˆã‚‹ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
Phase 3: é«˜åº¦ãªäºˆæ¸¬çš„å­¦ç¿’æ”¯æ´

2. 30å•è¨ºæ–­â†’AIåˆ†æâ†’å€‹åˆ¥ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ 

å­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«ã€ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã€èˆˆå‘³ã€æ€§æ ¼ç‰¹æ€§ã‚’å¤šè§’çš„ã«åˆ†æ
Claude/Geminiã®é«˜åº¦ãªè¨€èªç†è§£ã§ã‚ˆã‚Šç²¾å¯†ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°
å€‹äººã«æœ€é©åŒ–ã•ã‚ŒãŸã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã‚’è‡ªå‹•ç”Ÿæˆ

3. ãƒãƒ«ãƒLLMå¯¾å¿œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

Claudeã€Geminiã€ChatGPTã‚’ç”¨é€”ã«å¿œã˜ã¦ä½¿ã„åˆ†ã‘
APIã‚³ã‚¹ãƒˆæœ€é©åŒ–ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ ã§åŠ¹ç‡åŒ–

ğŸš€ ç«¶åˆå„ªä½æ€§
å¾“æ¥ã®å­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ã®å·®åˆ¥åŒ–:

é™çš„ã‚³ãƒ¼ã‚¹ â†’ å‹•çš„ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚º
ä¸€å¾‹ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ  â†’ AIç”Ÿæˆå€‹åˆ¥ãƒ—ãƒ©ãƒ³
äº‹å¾Œåˆ†æ â†’ äºˆæ¸¬çš„æ”¯æ´

å®Ÿè£…ã®ç¾å®Ÿæ€§:

æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã‚’æœ€å¤§é™æ´»ç”¨
æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹æ®µéšçš„å±•é–‹
é–‹ç™ºãƒªã‚¹ã‚¯ã®æœ€å°åŒ–

ğŸ“‹ æ¨å¥¨ã™ã‚‹é–‹ç™ºé–‹å§‹æ‰‹é †
ä»Šã™ãé–‹å§‹ã§ãã‚‹ã“ã¨ï¼ˆPhase 1ï¼‰

è¨ºæ–­ãƒ†ã‚¹ãƒˆDBæ§‹ç¯‰ (1é€±é–“)

30å•ã®è³ªå•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
åŸºæœ¬ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…


ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³åŸºç›¤ (2é€±é–“)

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«DB
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ 
åŸºæœ¬æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ 


UIå®Ÿè£… (1é€±é–“)

è¨ºæ–­ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸
ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
æ¨è–¦è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ



Phase 2ã§ã® AIçµ±åˆ (å¾Œæ—¥)

Claude/Gemini APIçµ±åˆ
è¨ºæ–­çµæœã®AIåˆ†æ
AIç”Ÿæˆã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ 

ã“ã®æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šï¼š

å³åº§ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªä¾¡å€¤æä¾›é–‹å§‹
æŠ€è¡“ãƒªã‚¹ã‚¯æœ€å°åŒ–
å¸‚å ´æ¤œè¨¼ã—ãªãŒã‚‰AIæ©Ÿèƒ½è¿½åŠ 

ã¾ãšã¯Phase 1ã®åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ã©ã®éƒ¨åˆ†ã‹ã‚‰å®Ÿè£…ã‚’é–‹å§‹ã—ãŸã„ã‹ã€ã¾ãŸã¯ç‰¹å®šã®æŠ€è¡“çš„ãªè³ªå•ã¯ã‚ã‚Šã¾ã™ã‹ï¼ŸRetryClaude can make mistakes. Please double-check responses.

# ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºå­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ  è¨­è¨ˆæ›¸

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼
```mermaid
graph TB
    A[æ–°è¦ç™»éŒ²] --> B[30å•è¨ºæ–­ãƒ†ã‚¹ãƒˆ]
    B --> C[Claude/Geminiåˆ†æ]
    C --> D[å­¦ç¿’è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ]
    D --> E[å€‹åˆ¥ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ä½œæˆ]
    E --> F[å­¦ç¿’é–‹å§‹]
    F --> G[å­¦ç¿’é€²æ—ãƒ‡ãƒ¼ã‚¿åé›†]
    G --> H[ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èª¿æ•´]
    H --> I[ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ æœ€é©åŒ–]
    I --> F
```

### 1.2 AIæ”¯æ´ã®æ®µéšçš„å°å…¥è¨ˆç”»

#### Phase 1: åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ ï¼ˆAIæ©Ÿèƒ½ãªã—ï¼‰
- é™çš„ãª30å•è¨ºæ–­ãƒ†ã‚¹ãƒˆ
- äº‹å‰å®šç¾©ã•ã‚ŒãŸã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- æ‰‹å‹•ã§ã®ã‚³ãƒ¼ã‚¹æ¨è–¦

#### Phase 2: AIåˆ†æå°å…¥
- Claude/Gemini APIã«ã‚ˆã‚‹è¨ºæ–­çµæœåˆ†æ
- AIç”Ÿæˆã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ 
- åŸºæœ¬çš„ãªå­¦ç¿’ã‚¢ãƒ‰ãƒã‚¤ã‚¹

#### Phase 3: é«˜åº¦ãªãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å­¦ç¿’è¡Œå‹•åˆ†æ
- å‹•çš„ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ èª¿æ•´
- äºˆæ¸¬çš„å­¦ç¿’æ”¯æ´

## 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆï¼ˆæ‹¡å¼µï¼‰

### 2.1 ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«
```sql
-- è¨ºæ–­ãƒ†ã‚¹ãƒˆ
CREATE TABLE diagnostic_tests (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    questions JSONB NOT NULL, -- 30å•ã®è³ªå•ãƒ‡ãƒ¼ã‚¿
    version INTEGER DEFAULT 1,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- è¨ºæ–­çµæœ
CREATE TABLE user_diagnostics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    test_id UUID REFERENCES diagnostic_tests(id),
    answers JSONB NOT NULL, -- å›ç­”ãƒ‡ãƒ¼ã‚¿
    raw_scores JSONB, -- å„åˆ†é‡ã®ã‚¹ã‚³ã‚¢
    ai_analysis JSONB, -- AIåˆ†æçµæœï¼ˆå¾Œã‹ã‚‰è¿½åŠ ï¼‰
    completed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, test_id)
);

-- å­¦ç¿’è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
CREATE TABLE user_learning_profiles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) UNIQUE,
    learning_style VARCHAR(50), -- visual, auditory, kinesthetic, mixed
    difficulty_preference VARCHAR(50), -- easy_start, challenge_driven, balanced
    pace_preference VARCHAR(50), -- slow, normal, fast
    interest_areas TEXT[], -- programming, design, music, etc.
    skill_levels JSONB, -- {"programming": 3, "design": 1, "music": 2}
    personality_traits JSONB, -- AIåˆ†æã«ã‚ˆã‚‹æ€§æ ¼ç‰¹æ€§
    motivation_factors TEXT[], -- achievement, creativity, social, etc.
    ai_insights JSONB, -- AIç”Ÿæˆã®è©³ç´°ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
    last_updated TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å€‹åˆ¥ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ 
CREATE TABLE personalized_curricula (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    profile_id UUID REFERENCES user_learning_profiles(id),
    curriculum_data JSONB NOT NULL, -- å€‹åˆ¥ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ æ§‹é€ 
    generation_method VARCHAR(50) DEFAULT 'template', -- template, ai_generated
    ai_rationale TEXT, -- AIç”Ÿæˆã®å ´åˆã®æ ¹æ‹ 
    estimated_duration_weeks INTEGER,
    difficulty_progression JSONB, -- é›£æ˜“åº¦ã®é€²è¡Œè¨ˆç”»
    checkpoint_milestones JSONB, -- ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¨­å®š
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å­¦ç¿’è¡Œå‹•ãƒ‡ãƒ¼ã‚¿ï¼ˆAIåˆ†æç”¨ï¼‰
CREATE TABLE learning_analytics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    session_id VARCHAR(255), -- å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³ID
    event_type VARCHAR(100), -- lesson_start, lesson_complete, pause, seek, etc.
    event_data JSONB, -- è©³ç´°ãªã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿
    timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    
    INDEX(user_id, timestamp)
);

-- AIç”Ÿæˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆå¾Œã‹ã‚‰å°å…¥ï¼‰
CREATE TABLE ai_generated_content (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    content_type VARCHAR(50), -- hint, explanation, exercise, quiz
    trigger_context JSONB, -- ç”Ÿæˆãƒˆãƒªã‚¬ãƒ¼ã¨ãªã£ãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
    generated_content JSONB, -- AIç”Ÿæˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    ai_model VARCHAR(50), -- claude, gemini, gpt4, etc.
    confidence_score DECIMAL(3,2),
    user_feedback INTEGER, -- 1-5 rating
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 2.2 30å•è¨ºæ–­ãƒ†ã‚¹ãƒˆã®è³ªå•æ§‹é€ 
```typescript
interface DiagnosticQuestion {
  id: string;
  category: 'learning_style' | 'skill_level' | 'interest' | 'personality' | 'motivation';
  question: string;
  type: 'multiple_choice' | 'scale' | 'ranking' | 'scenario';
  options?: string[];
  scale_range?: { min: number; max: number; labels: string[] };
  scenario?: {
    description: string;
    choices: { option: string; traits: string[] }[];
  };
}

// è³ªå•ä¾‹
const sampleQuestions: DiagnosticQuestion[] = [
  {
    id: "ls_001",
    category: "learning_style",
    question: "æ–°ã—ã„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’å­¦ã¶ã¨ãã€ã©ã®æ–¹æ³•ãŒæœ€ã‚‚åŠ¹æœçš„ã§ã™ã‹ï¼Ÿ",
    type: "multiple_choice",
    options: [
      "å‹•ç”»ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’è¦‹ã‚‹",
      "æ–‡æ›¸ã‚„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’èª­ã‚€", 
      "å®Ÿéš›ã«è§¦ã£ã¦è©¦ã™",
      "èª°ã‹ã«æ•™ãˆã¦ã‚‚ã‚‰ã†"
    ]
  },
  {
    id: "sk_001", 
    category: "skill_level",
    question: "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°çµŒé¨“ã¯ã©ã®ç¨‹åº¦ã§ã™ã‹ï¼Ÿ",
    type: "scale",
    scale_range: {
      min: 1,
      max: 5,
      labels: ["å…¨ããªã—", "å°‘ã—ã‚ã‚‹", "åŸºæœ¬ã¯ã§ãã‚‹", "çµæ§‹ã§ãã‚‹", "ä¸Šç´šè€…"]
    }
  },
  {
    id: "int_001",
    category: "interest",
    question: "ä»¥ä¸‹ã®åˆ†é‡ã‚’èˆˆå‘³é †ã«ä¸¦ã¹ã¦ãã ã•ã„",
    type: "ranking",
    options: [
      "Webã‚¢ãƒ—ãƒªé–‹ç™º",
      "ã‚²ãƒ¼ãƒ é–‹ç™º", 
      "AI/æ©Ÿæ¢°å­¦ç¿’",
      "3DCG/ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³",
      "éŸ³æ¥½åˆ¶ä½œ"
    ]
  },
  {
    id: "per_001",
    category: "personality",
    question: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å–ã‚Šçµ„ã‚€ã¨ã",
    type: "scenario",
    scenario: {
      description: "å¤§ããªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä¸ãˆã‚‰ã‚Œã¾ã—ãŸã€‚ã‚ãªãŸã®è¡Œå‹•ã¯ï¼Ÿ",
      choices: [
        { option: "ã¾ãšå…¨ä½“ã‚’æŠŠæ¡ã—ã¦ã‹ã‚‰è¨ˆç”»ã‚’ç«‹ã¦ã‚‹", traits: ["analytical", "planning"] },
        { option: "ã¨ã‚Šã‚ãˆãšå§‹ã‚ã¦ã¿ã‚‹", traits: ["action_oriented", "experimental"] },
        { option: "é¡ä¼¼äº‹ä¾‹ã‚’èª¿ã¹ã‚‹", traits: ["research_driven", "cautious"] },
        { option: "ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨ç›¸è«‡ã™ã‚‹", traits: ["collaborative", "social"] }
      ]
    }
  }
];
```

## 3. AIçµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆå¾Œã‹ã‚‰å°å…¥ï¼‰

### 3.1 ãƒãƒ«ãƒLLMå¯¾å¿œã‚·ã‚¹ãƒ†ãƒ 
```typescript
// src/services/ai/LLMProvider.ts
export interface LLMProvider {
  name: string;
  analyze(prompt: string, context?: any): Promise<AIResponse>;
  generateCurriculum(profile: UserProfile, diagnostics: DiagnosticResult): Promise<Curriculum>;
  provideHint(question: string, context: LearningContext): Promise<string>;
}

export class ClaudeProvider implements LLMProvider {
  name = 'claude';
  
  async analyze(prompt: string, context?: any): Promise<AIResponse> {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${process.env.CLAUDE_API_KEY}`,
        'anthropic-version': '2023-06-01'
      },
      body: JSON.stringify({
        model: 'claude-3-5-sonnet-20241022',
        max_tokens: 4000,
        messages: [{
          role: 'user',
          content: prompt
        }]
      })
    });
    
    const data = await response.json();
    return {
      content: data.content[0].text,
      model: 'claude-3.5-sonnet',
      confidence: 0.95
    };
  }

  async generateCurriculum(profile: UserProfile, diagnostics: DiagnosticResult): Promise<Curriculum> {
    const prompt = this.buildCurriculumPrompt(profile, diagnostics);
    const response = await this.analyze(prompt);
    
    try {
      return JSON.parse(response.content);
    } catch {
      throw new Error('Failed to parse curriculum from AI response');
    }
  }

  private buildCurriculumPrompt(profile: UserProfile, diagnostics: DiagnosticResult): string {
    return `
ã‚ãªãŸã¯æ•™è‚²å°‚é–€ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ä»¥ä¸‹ã®å­¦ç¿’è€…æƒ…å ±ã«åŸºã¥ã„ã¦ã€æœ€é©ãªå€‹åˆ¥ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

## å­¦ç¿’è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
- å­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«: ${profile.learning_style}
- ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«: ${JSON.stringify(profile.skill_levels)}
- èˆˆå‘³åˆ†é‡: ${profile.interest_areas.join(', ')}
- ãƒšãƒ¼ã‚¹å‚¾å‘: ${profile.pace_preference}

## è¨ºæ–­ãƒ†ã‚¹ãƒˆçµæœ
${JSON.stringify(diagnostics.raw_scores, null, 2)}

## åˆ©ç”¨å¯èƒ½ã‚³ãƒ¼ã‚¹
- Python/AIé–‹ç™ºã‚³ãƒ¼ã‚¹ (åˆç´šã€œä¸Šç´š)
- Unity ã‚²ãƒ¼ãƒ é–‹ç™ºã‚³ãƒ¼ã‚¹ (ä¸­ç´šã€œä¸Šç´š)  
- Blender 3DCGã‚³ãƒ¼ã‚¹ (åˆç´šã€œä¸­ç´š)
- Ableton éŸ³æ¥½åˆ¶ä½œã‚³ãƒ¼ã‚¹ (åˆç´šã€œä¸­ç´š)

## è¦æ±‚äº‹é …
1. å­¦ç¿’è€…ã®èˆˆå‘³ã¨ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã«æœ€é©åŒ–ã•ã‚ŒãŸã‚³ãƒ¼ã‚¹é †åº
2. å„ã‚³ãƒ¼ã‚¹ã®æ¨å¥¨å­¦ç¿’æœŸé–“ï¼ˆé€±å˜ä½ï¼‰
3. ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¨­å®šï¼ˆé”æˆç›®æ¨™ï¼‰
4. å­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«ã«å¿œã˜ãŸå­¦ç¿’æ–¹æ³•ã®ææ¡ˆ
5. ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç¶­æŒã®ãŸã‚ã®å·¥å¤«

ä»¥ä¸‹ã®JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š

{
  "recommended_path": [
    {
      "course_id": "string",
      "course_name": "string", 
      "start_week": number,
      "duration_weeks": number,
      "difficulty_level": "beginner|intermediate|advanced",
      "rationale": "string"
    }
  ],
  "milestones": [
    {
      "week": number,
      "title": "string",
      "description": "string",
      "success_criteria": ["string"]
    }
  ],
  "learning_strategies": {
    "primary_method": "string",
    "supplementary_methods": ["string"],
    "practice_frequency": "string"
  },
  "personalization_notes": {
    "strengths": ["string"],
    "areas_for_growth": ["string"], 
    "motivation_tips": ["string"]
  }
}
`;
  }
}

export class GeminiProvider implements LLMProvider {
  name = 'gemini';
  
  async analyze(prompt: string, context?: any): Promise<AIResponse> {
    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${process.env.GEMINI_API_KEY}`
      },
      body: JSON.stringify({
        contents: [{
          parts: [{ text: prompt }]
        }],
        generationConfig: {
          maxOutputTokens: 4000,
          temperature: 0.7
        }
      })
    });
    
    const data = await response.json();
    return {
      content: data.candidates[0].content.parts[0].text,
      model: 'gemini-pro',
      confidence: 0.9
    };
  }

  async generateCurriculum(profile: UserProfile, diagnostics: DiagnosticResult): Promise<Curriculum> {
    // ClaudeProviderã¨åŒæ§˜ã®å®Ÿè£…
    const prompt = this.buildCurriculumPrompt(profile, diagnostics);
    const response = await this.analyze(prompt);
    
    try {
      return JSON.parse(response.content);
    } catch {
      throw new Error('Failed to parse curriculum from AI response');
    }
  }
}

// LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
export class LLMManager {
  private providers: Map<string, LLMProvider> = new Map();
  private defaultProvider: string = 'claude';

  constructor() {
    this.providers.set('claude', new ClaudeProvider());
    this.providers.set('gemini', new GeminiProvider());
  }

  async generatePersonalizedCurriculum(
    profile: UserProfile, 
    diagnostics: DiagnosticResult,
    providerName?: string
  ): Promise<Curriculum> {
    const provider = this.providers.get(providerName || this.defaultProvider);
    if (!provider) {
      throw new Error(`Provider ${providerName} not found`);
    }

    return await provider.generateCurriculum(profile, diagnostics);
  }

  async analyzeProgress(
    userId: string,
    progressData: LearningProgress[],
    providerName?: string
  ): Promise<ProgressInsights> {
    const provider = this.providers.get(providerName || this.defaultProvider);
    if (!provider) {
      throw new Error(`Provider ${providerName} not found`);
    }

    const prompt = this.buildProgressAnalysisPrompt(progressData);
    const response = await provider.analyze(prompt);
    
    return JSON.parse(response.content);
  }

  private buildProgressAnalysisPrompt(progressData: LearningProgress[]): string {
    return `
å­¦ç¿’é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ã€å­¦ç¿’è€…ã®çŠ¶æ³ã¨ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ èª¿æ•´æ¡ˆã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚

## é€²æ—ãƒ‡ãƒ¼ã‚¿
${JSON.stringify(progressData, null, 2)}

ä»¥ä¸‹ã®è¦³ç‚¹ã§åˆ†æã—ã¦ãã ã•ã„ï¼š
1. å­¦ç¿’ãƒšãƒ¼ã‚¹ã®åˆ†æ
2. ã¤ã¾ãšããƒã‚¤ãƒ³ãƒˆã®ç‰¹å®š
3. ç†è§£åº¦ã®è©•ä¾¡
4. ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã®æ¨å®š
5. ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ èª¿æ•´ã®ææ¡ˆ

JSONå½¢å¼ã§å‡ºåŠ›ï¼š
{
  "pace_analysis": {
    "current_pace": "slow|normal|fast",
    "pace_trend": "improving|stable|declining",
    "recommendation": "string"
  },
  "difficulty_points": [
    {
      "lesson_id": "string",
      "issue": "string", 
      "suggested_action": "string"
    }
  ],
  "understanding_level": {
    "overall_score": number,
    "strong_areas": ["string"],
    "weak_areas": ["string"]
  },
  "curriculum_adjustments": [
    {
      "type": "add_practice|skip_lesson|extend_time|add_support",
      "target": "string",
      "rationale": "string"
    }
  ]
}
`;
  }
}
```

### 3.2 è¨ºæ–­ãƒ†ã‚¹ãƒˆã¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
```typescript
// src/services/personalization/DiagnosticService.ts
export class DiagnosticService {
  async processAnswers(userId: string, answers: DiagnosticAnswers): Promise<UserLearningProfile> {
    // Phase 1: åŸºæœ¬çš„ãªã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆAIä½¿ç”¨ã›ãšï¼‰
    const basicProfile = this.calculateBasicProfile(answers);
    
    // Phase 2ä»¥é™: AIåˆ†æã‚’è¿½åŠ 
    if (this.isAIEnabled()) {
      const aiInsights = await this.analyzeWithAI(answers);
      return this.mergeProfileWithAI(basicProfile, aiInsights);
    }
    
    return basicProfile;
  }

  private calculateBasicProfile(answers: DiagnosticAnswers): UserLearningProfile {
    const profile: UserLearningProfile = {
      learning_style: this.determineLearningStyle(answers),
      difficulty_preference: this.determineDifficultyPreference(answers),
      pace_preference: this.determinePacePreference(answers),
      interest_areas: this.extractInterestAreas(answers),
      skill_levels: this.calculateSkillLevels(answers),
      personality_traits: this.identifyPersonalityTraits(answers),
      motivation_factors: this.extractMotivationFactors(answers)
    };

    return profile;
  }

  private async analyzeWithAI(answers: DiagnosticAnswers): Promise<AIInsights> {
    const llmManager = new LLMManager();
    
    const prompt = `
ä»¥ä¸‹ã®è¨ºæ–­ãƒ†ã‚¹ãƒˆå›ç­”ã‚’åˆ†æã—ã¦ã€å­¦ç¿’è€…ã®æ·±å±¤çš„ãªç‰¹æ€§ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚

## å›ç­”ãƒ‡ãƒ¼ã‚¿
${JSON.stringify(answers, null, 2)}

ä»¥ä¸‹ã®è¦³ç‚¹ã§è©³ç´°åˆ†æï¼š
1. èªçŸ¥ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè«–ç†çš„æ€è€ƒ vs ç›´æ„Ÿçš„æ€è€ƒï¼‰
2. å­¦ç¿’å‹•æ©Ÿã®æºæ³‰
3. ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§ã¨æŒ‘æˆ¦å¿—å‘
4. ç¤¾ä¼šçš„å­¦ç¿’ vs ç‹¬ç«‹å­¦ç¿’ã®å‚¾å‘
5. å‰µé€ æ€§ã¨ä½“ç³»æ€§ã®ãƒãƒ©ãƒ³ã‚¹

JSONå½¢å¼ã§å‡ºåŠ›ï¼š
{
  "cognitive_style": {
    "thinking_pattern": "analytical|intuitive|mixed",
    "processing_speed": "deliberate|normal|quick",
    "detail_orientation": "high|medium|low"
  },
  "motivation_profile": {
    "primary_drivers": ["achievement", "mastery", "social", "creativity"],
    "reward_sensitivity": "high|medium|low",
    "feedback_preference": "immediate|periodic|milestone"
  },
  "challenge_tolerance": {
    "frustration_threshold": "low|medium|high",
    "help_seeking_tendency": "proactive|reactive|reluctant",
    "persistence_level": "low|medium|high"
  },
  "social_learning": {
    "collaboration_preference": "group|pair|individual",
    "peer_interaction": "active|moderate|minimal",
    "mentorship_value": "high|medium|low"
  },
  "creative_systematic": {
    "creativity_score": number,
    "systematicity_score": number,
    "preferred_structure": "loose|balanced|rigid"
  }
}
`;

    const response = await llmManager.analyze(prompt);
    return JSON.parse(response.content);
  }

  private determineLearningStyle(answers: DiagnosticAnswers): string {
    // å­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«é–¢é€£ã®è³ªå•ã‚’åˆ†æ
    const styleScores = {
      visual: 0,
      auditory: 0, 
      kinesthetic: 0,
      reading: 0
    };

    // å„å›ç­”ã‚’åˆ†æã—ã¦ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
    answers.forEach(answer => {
      if (answer.category === 'learning_style') {
        // å›ç­”ã«åŸºã¥ã„ã¦ã‚¹ã‚³ã‚¢ã‚’èª¿æ•´
        this.updateLearningStyleScores(styleScores, answer);
      }
    });

    // æœ€é«˜ã‚¹ã‚³ã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿”ã™
    return Object.entries(styleScores).reduce((a, b) => 
      styleScores[a] > styleScores[b] ? a : b
    );
  }

  private async generateCurriculum(
    profile: UserLearningProfile,
    diagnostics: DiagnosticResult
  ): Promise<PersonalizedCurriculum> {
    if (this.isAIEnabled()) {
      // AIç”Ÿæˆã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ 
      const llmManager = new LLMManager();
      const aiCurriculum = await llmManager.generatePersonalizedCurriculum(profile, diagnostics);
      
      return {
        ...aiCurriculum,
        generation_method: 'ai_generated',
        ai_rationale: aiCurriculum.personalization_notes
      };
    } else {
      // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹ã®ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ 
      return this.generateTemplateCurriculum(profile, diagnostics);
    }
  }

  private generateTemplateCurriculum(
    profile: UserLearningProfile,
    diagnostics: DiagnosticResult
  ): PersonalizedCurriculum {
    // äº‹å‰å®šç¾©ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰é¸æŠãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
    const templates = this.loadCurriculumTemplates();
    const bestTemplate = this.selectBestTemplate(templates, profile);
    
    return this.customizeTemplate(bestTemplate, profile, diagnostics);
  }
}
```

## 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

### 4.1 30å•è¨ºæ–­ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
```typescript
// src/pages/DiagnosticTest.tsx
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuthStore } from '../store/authStore';
import { DiagnosticService } from '../services/personalization/DiagnosticService';
import { ProgressBar } from '../components/common/ProgressBar';
import { QuestionCard } from '../components/diagnostic/QuestionCard';

export const DiagnosticTest: React.FC = () => {
  const navigate = useNavigate();
  const { user } = useAuthStore();
  const [questions, setQuestions] = useState<DiagnosticQuestion[]>([]);
  const [currentIndex, setCurrentIndex] = useState(0);
  const [answers, setAnswers] = useState<DiagnosticAnswers>([]);
  const [isLoading, setIsLoading] = useState(false);

  useEffect(() => {
    loadQuestions();
  }, []);

  const loadQuestions = async () => {
    const diagnosticService = new DiagnosticService();
    const testQuestions = await diagnosticService.getLatestTest();
    setQuestions(testQuestions);
  };

  const handleAnswer = (answer: any) => {
    const newAnswers = [...answers];
    newAnswers[currentIndex] = {
      question_id: questions[currentIndex].id,
      category: questions[currentIndex].category,
      answer: answer,
      timestamp: new Date().toISOString()
    };
    setAnswers(newAnswers);
  };

  const nextQuestion = () => {
    if (currentIndex < questions.length - 1) {
      setCurrentIndex(currentIndex + 1);
    } else {
      submitTest();
    }
  };

  const previousQuestion = () => {
    if (currentIndex > 0) {
      setCurrentIndex(currentIndex - 1);
    }
  };

  const submitTest = async () => {
    if (!user) return;
    
    setIsLoading(true);
    try {
      const diagnosticService = new DiagnosticService();
      const profile = await diagnosticService.processAnswers(user.id, answers);
      
      // çµæœãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      navigate('/diagnostic/results', { 
        state: { profile, isFirstTime: true }
      });
    } catch (error) {
      console.error('è¨ºæ–­ãƒ†ã‚¹ãƒˆå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
    } finally {
      setIsLoading(false);
    }
  };

  if (questions.length === 0) {
    return <div className="flex justify-center p-8">èª­ã¿è¾¼ã¿ä¸­...</div>;
  }

  const currentQuestion = questions[currentIndex];
  const progress = ((currentIndex + 1) / questions.length) * 100;

  return (
    <div className="max-w-4xl mx-auto p-6">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900 mb-4">
          ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºè¨ºæ–­ãƒ†ã‚¹ãƒˆ
        </h1>
        <p className="text-gray-600 mb-6">
          ã‚ãªãŸã«æœ€é©ãªå­¦ç¿’ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã™ã‚‹ãŸã‚ã€30å•ã®è³ªå•ã«ãŠç­”ãˆãã ã•ã„ã€‚
        </p>
        
        <ProgressBar 
          progress={progress} 
          label={`è³ªå• ${currentIndex + 1} / ${questions.length}`}
        />
      </div>

      <QuestionCard
        question={currentQuestion}
        answer={answers[currentIndex]?.answer}
        onAnswer={handleAnswer}
      />

      <div className="flex justify-between mt-8">
        <button
          onClick={previousQuestion}
          disabled={currentIndex === 0}
          className="px-6 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50"
        >
          å‰ã®è³ªå•
        </button>

        <button
          onClick={nextQuestion}
          disabled={!answers[currentIndex]}
          className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
        >
          {currentIndex === questions.length - 1 ? 'çµæœã‚’è¦‹ã‚‹' : 'æ¬¡ã®è³ªå•'}
        </button>
      </div>

      {isLoading && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white p-6 rounded-lg">
            <div className="flex items-center space-x-3">
              <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
              <span>åˆ†æä¸­...</span>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};
```

### 4.2 ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸå­¦ç¿’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
```typescript
// src/pages/PersonalizedDashboard.tsx
import React, { useEffect, useState } from 'react';
import { useAuthStore } from '../store/authStore';
import { PersonalizationService } from '../services/personalization/PersonalizationService';
import { LearningPathCard } from '../components/personalization/LearningPathCard';
import { ProgressInsights } from '../components/personalization/ProgressInsights';
import { AdaptiveRecommendations } from '../components/personalization/AdaptiveRecommendations';

export const PersonalizedDashboard: React.FC = () => {
  const { user } = useAuthStore();
  const [profile, setProfile] = useState<UserLearningProfile | null>(null);
  const [curriculum, setCurriculum] = useState<PersonalizedCurriculum | null>(null);
  const [insights, setInsights] = useState<ProgressInsights | null>(null);

  useEffect(() => {
    if (user) {
      loadPersonalizationData();
    }
  }, [user]);

  const loadPersonalizationData = async () => {
    if (!user) return;

    const personalizationService = new PersonalizationService();
    
    try {
      const [userProfile, userCurriculum, progressInsights] = await Promise.all([
        personalizationService.getProfile(user.id),
        personalizationService.getCurriculum(user.id),
        personalizationService.getProgressInsights(user.id)
      ]);

      setProfile(userProfile);
      setCurriculum(userCurriculum);
      setInsights(progressInsights);
    } catch (error) {
      console.error('ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  };

  if (!profile || !curriculum) {
    return (
      <div className="max-w-6xl mx-auto p-6">
        <div className="text-center">
          <h2 className="text-2xl font-bold text-gray-900 mb-4">
            ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸå­¦ç¿’ä½“é¨“ã¸ã‚ˆã†ã“ã
          </h2>
          <p className="text-gray-600 mb-6">
            ã¾ãšã¯è¨ºæ–­ãƒ†ã‚¹ãƒˆã‚’å—ã‘ã¦ã€ã‚ãªãŸå°‚ç”¨ã®å­¦ç¿’ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚
          </p>
          <button
            onClick={() => navigate('/diagnostic')}
            className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700"
          >
            è¨ºæ–­ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="max-w-6xl mx-auto p-6 space-y-8">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="text-center">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">
          ã‚ãªãŸå°‚ç”¨ã®å­¦ç¿’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
        </h1>
        <p className="text-gray-600">
          {profile.learning_style}ã‚¿ã‚¤ãƒ—ã®å­¦ç¿’è€…å‘ã‘ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚Œã¦ã„ã¾ã™
        </p>
      </div>

      {/* å­¦ç¿’ãƒ‘ã‚¹ */}
      <section>
        <h2 className="text-2xl font-semibold text-gray-900 mb-4">
          æ¨å¥¨å­¦ç¿’ãƒ‘ã‚¹
        </h2>
        <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {curriculum.recommended_path.map((course, index) => (
            <LearningPathCard
              key={course.course_id}
              course={course}
              order={index + 1}
              isActive={index === 0} // æœ€åˆã®ã‚³ãƒ¼ã‚¹ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
              isCompleted={false} // å®Ÿéš›ã®é€²æ—ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰åˆ¤å®š
            />
          ))}
        </div>
      </section>

      {/* é€²æ—ã‚¤ãƒ³ã‚µã‚¤ãƒˆ */}
      {insights && (
        <section>
          <h2 className="text-2xl font-semibold text-gray-900 mb-4">
            å­¦ç¿’é€²æ—åˆ†æ
          </h2>
          <ProgressInsights insights={insights} />
        </section>
      )}

      {/* AIæ¨è–¦ */}
      <section>
        <h2 className="text-2xl font-semibold text-gray-900 mb-4">
          ã‚ãªãŸã¸ã®æ¨è–¦
        </h2>
        <AdaptiveRecommendations 
          profile={profile}
          curriculum={curriculum}
          insights={insights}
        />
      </section>

      {/* å­¦ç¿’çµ±è¨ˆ */}
      <section className="grid gap-6 md:grid-cols-2 lg:grid-cols-4">
        <div className="bg-blue-50 p-6 rounded-lg">
          <h3 className="text-sm font-medium text-blue-600 mb-2">ä»Šé€±ã®å­¦ç¿’æ™‚é–“</h3>
          <p className="text-3xl font-bold text-blue-900">12.5æ™‚é–“</p>
          <p className="text-sm text-blue-600">ç›®æ¨™: 10æ™‚é–“</p>
        </div>
        
        <div className="bg-green-50 p-6 rounded-lg">
          <h3 className="text-sm font-medium text-green-600 mb-2">å®Œäº†ãƒ¬ãƒƒã‚¹ãƒ³</h3>
          <p className="text-3xl font-bold text-green-900">23</p>
          <p className="text-sm text-green-600">ç·ãƒ¬ãƒƒã‚¹ãƒ³: 45</p>
        </div>
        
        <div className="bg-yellow-50 p-6 rounded-lg">
          <h3 className="text-sm font-medium text-yellow-600 mb-2">ç¿’å¾—ã‚¹ã‚­ãƒ«</h3>
          <p className="text-3xl font-bold text-yellow-900">7</p>
          <p className="text-sm text-yellow-600">æ–°ã—ã„ã‚¹ã‚­ãƒ«</p>
        </div>
        
        <div className="bg-purple-50 p-6 rounded-lg">
          <h3 className="text-sm font-medium text-purple-600 mb-2">ã‚¹ãƒˆãƒªãƒ¼ã‚¯</h3>
          <p className="text-3xl font-bold text-purple-900">14æ—¥</p>
          <p className="text-sm text-purple-600">é€£ç¶šå­¦ç¿’</p>
        </div>
      </section>
    </div>
  );
};
```

### 4.3 AIæ¨è–¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
```typescript
// src/components/personalization/AdaptiveRecommendations.tsx
import React, { useState, useEffect } from 'react';
import { Lightbulb, TrendingUp, Clock, Target } from 'lucide-react';

interface AdaptiveRecommendationsProps {
  profile: UserLearningProfile;
  curriculum: PersonalizedCurriculum;
  insights: ProgressInsights | null;
}

export const AdaptiveRecommendations: React.FC<AdaptiveRecommendationsProps> = ({
  profile,
  curriculum,
  insights
}) => {
  const [recommendations, setRecommendations] = useState<AIRecommendation[]>([]);
  const [isLoading, setIsLoading] = useState(false);

  useEffect(() => {
    generateRecommendations();
  }, [profile, insights]);

  const generateRecommendations = async () => {
    setIsLoading(true);
    try {
      // Phase 1: åŸºæœ¬çš„ãªæ¨è–¦ãƒ­ã‚¸ãƒƒã‚¯
      const basicRecommendations = generateBasicRecommendations();
      
      // Phase 2ä»¥é™: AIç”Ÿæˆæ¨è–¦ã‚’è¿½åŠ 
      const aiRecommendations = await generateAIRecommendations();
      
      setRecommendations([...basicRecommendations, ...aiRecommendations]);
    } catch (error) {
      console.error('æ¨è–¦ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: åŸºæœ¬æ¨è–¦ã®ã¿
      setRecommendations(generateBasicRecommendations());
    } finally {
      setIsLoading(false);
    }
  };

  const generateBasicRecommendations = (): AIRecommendation[] => {
    const recommendations: AIRecommendation[] = [];

    // å­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®æ¨è–¦
    if (profile.learning_style === 'visual') {
      recommendations.push({
        type: 'learning_tip',
        title: 'ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«å­¦ç¿’ã®ã‚³ãƒ„',
        description: 'ã‚³ãƒ¼ãƒ‰ã‚’å›³ã‚„ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã§è¦–è¦šåŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã†',
        icon: 'lightbulb',
        priority: 'high'
      });
    }

    // é€²æ—ãƒ™ãƒ¼ã‚¹ã®æ¨è–¦
    if (insights?.pace_analysis.current_pace === 'slow') {
      recommendations.push({
        type: 'pace_adjustment',
        title: 'å­¦ç¿’ãƒšãƒ¼ã‚¹ã®èª¿æ•´',
        description: 'çŸ­æ™‚é–“ã®é›†ä¸­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¢—ã‚„ã™ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™',
        icon: 'clock',
        priority: 'medium'
      });
    }

    return recommendations;
  };

  const generateAIRecommendations = async (): Promise<AIRecommendation[]> => {
    // AIæ©Ÿèƒ½ãŒæœ‰åŠ¹ãªå ´åˆã®ã¿å®Ÿè¡Œ
    if (!window.AI_ENABLED) return [];

    const llmManager = new LLMManager();
    const prompt = `
å­¦ç¿’è€…ã®çŠ¶æ³ã«åŸºã¥ã„ã¦ã€å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½ãªæ¨è–¦ã‚’3ã¤ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

## å­¦ç¿’è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
${JSON.stringify(profile, null, 2)}

## é€²æ—ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
${JSON.stringify(insights, null, 2)}

ä»¥ä¸‹ã®è¦³ç‚¹ã§æ¨è–¦ã‚’ç”Ÿæˆï¼š
1. å­¦ç¿’åŠ¹ç‡ã‚’å‘ä¸Šã•ã›ã‚‹å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹
2. ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç¶­æŒã®ãŸã‚ã®ææ¡ˆ
3. ã‚¹ã‚­ãƒ«å‘ä¸Šã®ãŸã‚ã®æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

JSONå½¢å¼ã§å‡ºåŠ›ï¼š
{
  "recommendations": [
    {
      "type": "learning_tip|motivation|skill_development|time_management",
      "title": "string",
      "description": "string", 
      "action_items": ["string"],
      "expected_benefit": "string",
      "priority": "high|medium|low"
    }
  ]
}
`;

    try {
      const response = await llmManager.analyze(prompt);
      const data = JSON.parse(response.content);
      return data.recommendations;
    } catch (error) {
      console.error('AIæ¨è–¦ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  };

  const getRecommendationIcon = (type: string) => {
    switch (type) {
      case 'learning_tip': return <Lightbulb className="w-5 h-5" />;
      case 'pace_adjustment': return <Clock className="w-5 h-5" />;
      case 'skill_development': return <TrendingUp className="w-5 h-5" />;
      case 'motivation': return <Target className="w-5 h-5" />;
      default: return <Lightbulb className="w-5 h-5" />;
    }
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'high': return 'border-red-200 bg-red-50';
      case 'medium': return 'border-yellow-200 bg-yellow-50';
      case 'low': return 'border-blue-200 bg-blue-50';
      default: return 'border-gray-200 bg-gray-50';
    }
  };

  if (isLoading) {
    return (
      <div className="space-y-4">
        {[1, 2, 3].map(i => (
          <div key={i} className="border rounded-lg p-4 animate-pulse">
            <div className="h-4 bg-gray-200 rounded w-1/4 mb-2"></div>
            <div className="h-3 bg-gray-200 rounded w-3/4"></div>
          </div>
        ))}
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {recommendations.map((rec, index) => (
        <div 
          key={index}
          className={`border rounded-lg p-4 ${getPriorityColor(rec.priority)}`}
        >
          <div className="flex items-start space-x-3">
            <div className="flex-shrink-0 mt-1">
              {getRecommendationIcon(rec.type)}
            </div>
            <div className="flex-1">
              <h3 className="font-semibold text-gray-900 mb-1">
                {rec.title}
              </h3>
              <p className="text-gray-700 text-sm mb-2">
                {rec.description}
              </p>
              
              {rec.action_items && (
                <div className="mb-2">
                  <p className="text-xs font-medium text-gray-600 mb-1">
                    å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—:
                  </p>
                  <ul className="text-xs text-gray-600 list-disc list-inside space-y-1">
                    {rec.action_items.map((item, idx) => (
                      <li key={idx}>{item}</li>
                    ))}
                  </ul>
                </div>
              )}
              
              {rec.expected_benefit && (
                <p className="text-xs text-gray-500 italic">
                  æœŸå¾…åŠ¹æœ: {rec.expected_benefit}
                </p>
              )}
            </div>
            
            <div className="flex-shrink-0">
              <span className={`text-xs px-2 py-1 rounded-full ${
                rec.priority === 'high' ? 'bg-red-100 text-red-800' :
                rec.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                'bg-blue-100 text-blue-800'
              }`}>
                {rec.priority === 'high' ? 'é‡è¦' : 
                 rec.priority === 'medium' ? 'ä¸­' : 'ä½'}
              </span>
            </div>
          </div>
        </div>
      ))}
    </div>
  );
};
```

## 5. æ®µéšçš„é–‹ç™ºè¨ˆç”»ï¼ˆä¿®æ­£ç‰ˆï¼‰

### Phase 1: AIæ©Ÿèƒ½ãªã—åŸºç›¤æ§‹ç¯‰ï¼ˆ4é€±é–“ï¼‰
```typescript
// é–‹ç™ºå„ªå…ˆé †ä½
const phase1Tasks = [
  // Week 1-2: åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ 
  {
    task: "èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†",
    details: ["Supabase Authçµ±åˆ", "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†", "RLSãƒãƒªã‚·ãƒ¼è¨­å®š"]
  },
  {
    task: "ã‚³ãƒ¼ã‚¹ãƒ»ãƒ¬ãƒƒã‚¹ãƒ³è¡¨ç¤º", 
    details: ["æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ‹¡å¼µ", "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆ", "é€²æ—ç®¡ç†åŸºç›¤"]
  },
  
  // Week 3-4: è¨ºæ–­ãƒ»ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³åŸºç›¤
  {
    task: "30å•è¨ºæ–­ãƒ†ã‚¹ãƒˆ",
    details: ["è³ªå•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹", "ãƒ†ã‚¹ãƒˆUI", "åŸºæœ¬ã‚¹ã‚³ã‚¢è¨ˆç®—"]
  },
  {
    task: "ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹æ¨è–¦",
    details: ["äº‹å‰å®šç¾©ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ", "åŸºæœ¬ãƒãƒƒãƒãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯", "æ¨è–¦è¡¨ç¤º"]
  }
];
```

### Phase 2: AIçµ±åˆï¼ˆ6é€±é–“ï¼‰
```typescript
const phase2Tasks = [
  // Week 5-7: AIåˆ†æçµ±åˆ
  {
    task: "Claude/Gemini APIçµ±åˆ",
    details: ["LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å®Ÿè£…", "è¨ºæ–­çµæœAIåˆ†æ", "ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¼·åŒ–"]
  },
  {
    task: "AIç”Ÿæˆã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ",
    details: ["ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ", "çµæœãƒ‘ãƒ¼ã‚¹ãƒ»æ¤œè¨¼", "ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½"]
  },
  
  // Week 8-10: é«˜åº¦ãªãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
  {
    task: "å­¦ç¿’è¡Œå‹•åˆ†æ",
    details: ["è¡Œå‹•ãƒ‡ãƒ¼ã‚¿åé›†", "é€²æ—ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ", "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èª¿æ•´"]
  },
  {
    task: "é©å¿œçš„æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ ",
    details: ["AIæ¨è–¦ç”Ÿæˆ", "A/Bãƒ†ã‚¹ãƒˆæ©Ÿèƒ½", "æ¨è–¦åŠ¹æœæ¸¬å®š"]
  }
];
```

### Phase 3: é«˜åº¦ãªAIæ©Ÿèƒ½ï¼ˆ4é€±é–“ä»¥é™ï¼‰
```typescript
const phase3Tasks = [
  {
    task: "äºˆæ¸¬çš„å­¦ç¿’æ”¯æ´",
    details: ["ã¤ã¾ãšãäºˆæ¸¬", "å…ˆå›ã‚Šãƒ’ãƒ³ãƒˆ", "å‹•çš„é›£æ˜“åº¦èª¿æ•´"]
  },
  {
    task: "è‡ªç„¶è¨€èªè³ªå•å¯¾å¿œ",
    details: ["ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆçµ±åˆ", "ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç†è§£", "ãƒãƒ«ãƒã‚¿ãƒ¼ãƒ³å¯¾è©±"]
  },
  {
    task: "å­¦ç¿’æˆæœäºˆæ¸¬",
    details: ["æˆæœäºˆæ¸¬ãƒ¢ãƒ‡ãƒ«", "æœ€é©å­¦ç¿’ãƒ‘ã‚¹ç®—å‡º", "ç›®æ¨™é”æˆç¢ºç‡è¨ˆç®—"]
  }
];
```

## 6. è¨­å®šãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹AIæ©Ÿèƒ½åˆ¶å¾¡

### 6.1 ç’°å¢ƒå¤‰æ•°è¨­å®š
```typescript
// .env.local
VITE_AI_FEATURES_ENABLED=false
VITE_CLAUDE_API_KEY=sk-your-claude-key
VITE_GEMINI_API_KEY=your-gemini-key
VITE_AI_PROVIDER=claude # claude | gemini | openai

// Phaseåˆ¥æœ‰åŠ¹åŒ–
VITE_AI_ANALYSIS_ENABLED=false    # Phase 2ã§æœ‰åŠ¹åŒ–
VITE_AI_CURRICULUM_ENABLED=false  # Phase 2ã§æœ‰åŠ¹åŒ–  
VITE_AI_CHAT_ENABLED=false        # Phase 3ã§æœ‰åŠ¹åŒ–
VITE_AI_PREDICTION_ENABLED=false  # Phase 3ã§æœ‰åŠ¹åŒ–
```

### 6.2 æ©Ÿèƒ½åˆ‡ã‚Šæ›¿ãˆã‚µãƒ¼ãƒ“ã‚¹
```typescript
// src/services/FeatureFlags.ts
export class FeatureFlags {
  static get aiAnalysisEnabled(): boolean {
    return import.meta.env.VITE_AI_ANALYSIS_ENABLED === 'true';
  }

  static get aiCurriculumEnabled(): boolean {
    return import.meta.env.VITE_AI_CURRICULUM_ENABLED === 'true';
  }

  static get aiChatEnabled(): boolean {
    return import.meta.env.VITE_AI_CHAT_ENABLED === 'true';
  }

  static get aiPredictionEnabled(): boolean {
    return import.meta.env.VITE_AI_PREDICTION_ENABLED === 'true';
  }

  static get preferredAIProvider(): string {
    return import.meta.env.VITE_AI_PROVIDER || 'claude';
  }
}

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ç”¨ä¾‹
export const DiagnosticResults: React.FC = () => {
  const generateProfile = async () => {
    if (FeatureFlags.aiAnalysisEnabled) {
      // AIåˆ†æã‚’ä½¿ç”¨
      return await aiService.analyzeProfile(answers);
    } else {
      // åŸºæœ¬åˆ†æã‚’ä½¿ç”¨
      return basicAnalysis.analyzeProfile(answers);
    }
  };
};
```

## 7. ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

### 7.1 AI API ã‚³ã‚¹ãƒˆç®¡ç†
```typescript
// src/services/ai/CostManager.ts
export class AICostManager {
  private static readonly DAILY_LIMITS = {
    claude: 1000, // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ—¥
    gemini: 2000,
    total_cost: 50 // USD/æ—¥
  };

  static async checkUsageLimit(provider: string): Promise<boolean> {
    const usage = await this.getDailyUsage(provider);
    return usage < this.DAILY_LIMITS[provider];
  }

  static async logUsage(provider: string, tokens: number, cost: number) {
    await supabase.from('ai_usage_logs').insert({
      provider,
      tokens,
      cost,
      date: new Date().toISOString().split('T')[0]
    });
  }

  private static async getDailyUsage(provider: string): Promise<number> {
    const today = new Date().toISOString().split('T')[0];
    const { count } = await supabase
      .from('ai_usage_logs')
      .select('*', { count: 'exact' })
      .eq('provider', provider)
      .eq('date', today);
    
    return count || 0;
  }
}
```

### 7.2 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
```typescript
// src/services/ai/CacheManager.ts
export class AICacheManager {
  // ã‚ˆãã‚ã‚‹è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  static async getCachedResponse(
    prompt: string, 
    userProfile: UserProfile
  ): Promise<string | null> {
    const hash = this.generateHash(prompt, userProfile);
    
    const { data } = await supabase
      .from('ai_response_cache')
      .select('response')
      .eq('prompt_hash', hash)
      .gt('created_at', new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)) // 1é€±é–“ä»¥å†…
      .single();
    
    return data?.response || null;
  }

  static async cacheResponse(
    prompt: string,
    userProfile: UserProfile, 
    response: string
  ) {
    const hash = this.generateHash(prompt, userProfile);
    
    await supabase.from('ai_response_cache').upsert({
      prompt_hash: hash,
      response,
      created_at: new Date().toISOString()
    });
  }

  private static generateHash(prompt: string, profile: UserProfile): string {
    // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸»è¦ç‰¹å¾´ã®ã¿ã§ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆï¼ˆå€‹äººæƒ…å ±ã¯é™¤å¤–ï¼‰
    const key = `${prompt}_${profile.learning_style}_${profile.difficulty_preference}`;
    return btoa(key).slice(0, 32);
  }
}
```

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€**AIæ©Ÿèƒ½ã‚’æ®µéšçš„ã«å°å…¥**ã—ãªãŒã‚‰ã€**åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯å³åº§ã«æ§‹ç¯‰é–‹å§‹**ã§ãã¾ã™ã€‚Phase 1ã§ã¯å¾“æ¥ã®æ‰‹æ³•ã§å‹•ä½œã—ã€å¾Œã‹ã‚‰AIæ©Ÿèƒ½ã‚’ç„¡ç†ãªãçµ±åˆã§ãã‚‹æŸ”è»Ÿãªè¨­è¨ˆã«ãªã£ã¦ã„ã¾ã™ã€‚

Claude/Gemini APIã‚’æ´»ç”¨ã—ãŸ**30å•è¨ºæ–­â†’ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ç”Ÿæˆ**ã¯ã€ä»–ã®å­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ãªã„**å¼·åŠ›ãªå·®åˆ¥åŒ–è¦ç´ **ã«ãªã‚‹ã¨æ€ã„ã¾ã™ï¼

ä½•ã‹ç‰¹å®šã®éƒ¨åˆ†ã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„ç‚¹ã‚„ã€å®Ÿè£…ä¸Šã®è³ªå•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ

# e-school çµ±åˆè¦ä»¶å®šç¾©æ›¸ v2.0
## ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºå­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ çµ±åˆç‰ˆ

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### 1.1 ç›®çš„
AIæ”¯æ´å‹ã®ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ã—ã¦ã€å€‹äººã®å­¦ç¿’ç‰¹æ€§ã«å®Œå…¨é©å¿œã—ãŸæ•™è‚²ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹

### 1.2 å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼**: å°å­¦æ ¡é«˜å­¦å¹´ã€œé«˜æ ¡ç”Ÿï¼ˆ10-18æ­³ï¼‰
- **ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ¼**: ç¤¾ä¼šäººå­¦ç¿’è€…ï¼ˆ18-35æ­³ï¼‰
- **ä¿è­·è€…**: å­ä¾›ã®å­¦ç¿’ç®¡ç†ã‚’è¡Œã†ä¿è­·è€…
- **è¬›å¸«**: ã‚³ãƒ¼ã‚¹é‹å–¶ãƒ»æŒ‡å°ã‚’è¡Œã†è¬›å¸«

### 1.3 æä¾›ä¾¡å€¤
- **30å•è¨ºæ–­ã«ã‚ˆã‚‹ç²¾å¯†ãªãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**
- **AIç”Ÿæˆå€‹åˆ¥ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ **ï¼ˆPhase 2ä»¥é™ï¼‰
- **å®Ÿè·µçš„ãªãƒ‡ã‚¸ã‚¿ãƒ«ã‚¹ã‚­ãƒ«ç¿’å¾—**
- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å­¦ç¿’ç’°å¢ƒï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³+ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼‰**
- **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ã®å­¦ç¿’ä½“é¨“**

### 1.4 æ®µéšçš„é–‹ç™ºè¨ˆç”»
- **Phase 1**: åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ  + è¨ºæ–­ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ4é€±é–“ï¼‰
- **Phase 2**: AIçµ±åˆï¼ˆClaude/Geminiï¼‰ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ6é€±é–“ï¼‰
- **Phase 3**: é«˜åº¦ãªAIå­¦ç¿’æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ4é€±é–“ä»¥é™ï¼‰

## 2. æ©Ÿèƒ½è¦ä»¶

### 2.1 èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½

#### 2.1.1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³
- **å¿…é ˆæ©Ÿèƒ½**
  - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã®ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³
  - Google/GitHub OAuthé€£æº
  - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
  - ãƒ¡ãƒ¼ãƒ«èªè¨¼æ©Ÿèƒ½

- **æ‹¡å¼µæ©Ÿèƒ½**
  - ä¿è­·è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã®é€£æºï¼ˆæœªæˆå¹´ã®å ´åˆï¼‰
  - 2æ®µéšèªè¨¼å¯¾å¿œ
  - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

#### 2.1.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼å½¹å‰²ç®¡ç†
```typescript
enum UserRole {
  STUDENT = 'student',      // å—è¬›ç”Ÿ
  PARENT = 'parent',        // ä¿è­·è€…
  INSTRUCTOR = 'instructor', // è¬›å¸«
  ADMIN = 'admin'           // ç®¡ç†è€…
}

interface User {
  id: string;
  email: string;
  role: UserRole;
  profile: UserProfile;
  learningProfile?: UserLearningProfile; // æ–°è¦è¿½åŠ 
  createdAt: Date;
  lastLoginAt: Date;
}
```

### 2.2 ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ ã€æ–°è¦ã€‘

#### 2.2.1 30å•è¨ºæ–­ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ 
- **è¨ºæ–­ãƒ†ã‚¹ãƒˆç®¡ç†**
  - 30å•ã®å¤šè§’çš„è³ªå•è¨­è¨ˆ
  - å­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«ã€ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã€èˆˆå‘³ã€æ€§æ ¼ç‰¹æ€§ã®æ¸¬å®š
  - è¤‡æ•°å›å—é¨“ã«ã‚ˆã‚‹ç²¾åº¦å‘ä¸Š

- **è³ªå•ã‚¿ã‚¤ãƒ—**
  - å¤šé¸æŠè‚¢è³ªå•
  - ã‚¹ã‚±ãƒ¼ãƒ«è©•ä¾¡ï¼ˆ1-5æ®µéšï¼‰
  - å„ªå…ˆé †ä½ãƒ©ãƒ³ã‚­ãƒ³ã‚°
  - ã‚·ãƒŠãƒªã‚ªãƒ™ãƒ¼ã‚¹é¸æŠ

```typescript
interface DiagnosticTest {
  id: string;
  name: string;
  version: number;
  questions: DiagnosticQuestion[];
  isActive: boolean;
  createdAt: Date;
}

interface DiagnosticQuestion {
  id: string;
  category: 'learning_style' | 'skill_level' | 'interest' | 'personality' | 'motivation';
  question: string;
  type: 'multiple_choice' | 'scale' | 'ranking' | 'scenario';
  options?: string[];
  scaleRange?: { min: number; max: number; labels: string[] };
  scenario?: {
    description: string;
    choices: { option: string; traits: string[] }[];
  };
}
```

#### 2.2.2 å­¦ç¿’è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
- **Phase 1: åŸºæœ¬åˆ†æ**
  - çµ±è¨ˆçš„æ‰‹æ³•ã«ã‚ˆã‚‹ç‰¹æ€§åˆ†æ
  - äº‹å‰å®šç¾©ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹åˆ†é¡
  - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒãƒƒãƒãƒ³ã‚°

- **Phase 2: AIåˆ†æçµ±åˆ**
  - Claude/Gemini APIã«ã‚ˆã‚‹é«˜åº¦åˆ†æ
  - æ·±å±¤å­¦ç¿’ç‰¹æ€§ã®æŠ½å‡º
  - å­¦ç¿’è¡Œå‹•äºˆæ¸¬

```typescript
interface UserLearningProfile {
  id: string;
  userId: string;
  learningStyle: 'visual' | 'auditory' | 'kinesthetic' | 'reading' | 'mixed';
  difficultyPreference: 'easy_start' | 'challenge_driven' | 'balanced';
  pacePreference: 'slow' | 'normal' | 'fast';
  interestAreas: string[];
  skillLevels: Record<string, number>; // {"programming": 3, "design": 1}
  personalityTraits: Record<string, number>;
  motivationFactors: string[];
  aiInsights?: Record<string, any>; // Phase 2ã§è¿½åŠ 
  lastUpdated: Date;
}
```

#### 2.2.3 å€‹åˆ¥ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ç”Ÿæˆ
- **Phase 1: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹**
  - äº‹å‰å®šç¾©ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
  - ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒãƒ³ã‚°
  - åŸºæœ¬çš„ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

- **Phase 2: AIç”Ÿæˆ**
  - Claude/Geminiã«ã‚ˆã‚‹å®Œå…¨ã‚«ã‚¹ã‚¿ãƒ ç”Ÿæˆ
  - å­¦ç¿’ç›®æ¨™ã«å¿œã˜ãŸæœ€é©åŒ–
  - å‹•çš„ãªé›£æ˜“åº¦èª¿æ•´

```typescript
interface PersonalizedCurriculum {
  id: string;
  userId: string;
  profileId: string;
  curriculumData: {
    recommendedPath: CourseRecommendation[];
    milestones: LearningMilestone[];
    learningStrategies: LearningStrategy;
    personalizationNotes: PersonalizationNotes;
  };
  generationMethod: 'template' | 'ai_generated';
  aiRationale?: string; // AIç”Ÿæˆã®å ´åˆã®æ ¹æ‹ 
  estimatedDurationWeeks: number;
  difficultyProgression: Record<string, any>;
  checkpointMilestones: LearningMilestone[];
  createdAt: Date;
  updatedAt: Date;
}

interface CourseRecommendation {
  courseId: string;
  courseName: string;
  startWeek: number;
  durationWeeks: number;
  difficultyLevel: 'beginner' | 'intermediate' | 'advanced';
  rationale: string;
  prerequisites?: string[];
}
```

### 2.3 å­¦ç¿’ç®¡ç†æ©Ÿèƒ½ï¼ˆæ‹¡å¼µï¼‰

#### 2.3.1 ã‚³ãƒ¼ã‚¹ç®¡ç†
- **å¾“æ¥æ©Ÿèƒ½**
  - ã‚³ãƒ¼ã‚¹æ¦‚è¦ãƒ»ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ è¡¨ç¤º
  - é›£æ˜“åº¦ãƒ»å¯¾è±¡å¹´é½¢è¡¨ç¤º
  - æœŸé–“ãƒ»æ–™é‡‘æƒ…å ±
  - è¬›å¸«ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«

- **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æ‹¡å¼µ**
  - å€‹äººé©åˆåº¦ã‚¹ã‚³ã‚¢è¡¨ç¤º
  - ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚ŒãŸå­¦ç¿’ãƒ‘ã‚¹
  - å€‹åˆ¥æ¨å¥¨ç†ç”±ã®èª¬æ˜

#### 2.3.2 é©å¿œçš„å­¦ç¿’é€²æ—ç®¡ç†
- **åŸºæœ¬é€²æ—è¿½è·¡**
  - ãƒ¬ãƒƒã‚¹ãƒ³å®Œäº†ç‡
  - å­¦ç¿’æ™‚é–“è¨˜éŒ²
  - èª²é¡Œæå‡ºçŠ¶æ³
  - ç†è§£åº¦æ¸¬å®š

- **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºæ‹¡å¼µ**
  - å€‹äººãƒšãƒ¼ã‚¹ã«å¿œã˜ãŸç›®æ¨™èª¿æ•´
  - ã¤ã¾ãšããƒã‚¤ãƒ³ãƒˆã®æ—©æœŸæ¤œå‡º
  - å­¦ç¿’ã‚¹ã‚¿ã‚¤ãƒ«åˆ¥é€²æ—å¯è¦–åŒ–

- **AIå­¦ç¿’æ”¯æ´ï¼ˆPhase 2ä»¥é™ï¼‰**
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å­¦ç¿’è¡Œå‹•åˆ†æ
  - äºˆæ¸¬çš„å­¦ç¿’æ”¯æ´
  - å‹•çš„ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ èª¿æ•´

```typescript
interface AdaptiveLearningProgress {
  id: string;
  userId: string;
  lessonId: string;
  baseProgress: LessonProgress; // åŸºæœ¬é€²æ—æƒ…å ±
  personalizedMetrics: {
    adaptedPace: number; // å€‹äººãƒšãƒ¼ã‚¹é©å¿œå€¤
    difficultyAdjustment: number; // é›£æ˜“åº¦èª¿æ•´å€¤
    engagementScore: number; // ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚¹ã‚³ã‚¢
    predictedCompletion: Date; // å®Œäº†äºˆæ¸¬æ—¥
  };
  aiRecommendations?: string[]; // Phase 2ä»¥é™
  lastAnalyzed: Date;
}
```

### 2.4 AIçµ±åˆæ©Ÿèƒ½ï¼ˆPhase 2ä»¥é™ï¼‰

#### 2.4.1 ãƒãƒ«ãƒLLMçµ±åˆ
- **ã‚µãƒãƒ¼ãƒˆLLM**
  - Claude (Anthropic)
  - Gemini (Google)
  - GPT-4 (OpenAI) - å°†æ¥å¯¾å¿œ

- **LLMæ´»ç”¨é ˜åŸŸ**
  - è¨ºæ–­çµæœæ·±å±¤åˆ†æ
  - ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ è‡ªå‹•ç”Ÿæˆ
  - å­¦ç¿’è³ªå•ã¸ã®å›ç­”
  - å­¦ç¿’ãƒ’ãƒ³ãƒˆç”Ÿæˆ
  - é€²æ—åˆ†æãƒ»äºˆæ¸¬

```typescript
interface AIIntegration {
  providers: ('claude' | 'gemini' | 'openai')[];
  defaultProvider: string;
  usageLimits: {
    dailyRequests: number;
    dailyCost: number;
  };
  fallbackStrategy: 'template' | 'cache' | 'simplified';
}
```

#### 2.4.2 AIå­¦ç¿’æ”¯æ´
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ”¯æ´**
  - 24æ™‚é–“è³ªå•å¯¾å¿œ
  - å€‹åˆ¥å­¦ç¿’ãƒ’ãƒ³ãƒˆç”Ÿæˆ
  - ã¤ã¾ãšãäºˆæ¸¬ã‚¢ãƒ©ãƒ¼ãƒˆ

- **å­¦ç¿’æœ€é©åŒ–**
  - å€‹äººå­¦ç¿’ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
  - æœ€é©å­¦ç¿’æ™‚é–“ææ¡ˆ
  - ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ å‹•çš„èª¿æ•´

### 2.5 æ—¢å­˜æ©Ÿèƒ½ï¼ˆã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ»æ±ºæ¸ˆãƒ»ç®¡ç†ï¼‰
*å¾“æ¥ã®è¦ä»¶å®šç¾©å†…å®¹ã‚’ãã®ã¾ã¾ç¶­æŒ*

## 3. éæ©Ÿèƒ½è¦ä»¶ï¼ˆæ‹¡å¼µï¼‰

### 3.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶
- **åŸºæœ¬è¦ä»¶**
  - ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿2ç§’ä»¥å†…
  - åŒæ™‚æ¥ç¶š1,000ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ
  - å¯ç”¨æ€§99.9%ä»¥ä¸Š

- **AIæ©Ÿèƒ½è¦ä»¶ï¼ˆPhase 2ä»¥é™ï¼‰**
  - AIåˆ†æãƒ¬ã‚¹ãƒãƒ³ã‚¹: 30ç§’ä»¥å†…
  - è¨ºæ–­çµæœå‡¦ç†: 60ç§’ä»¥å†…
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¨è–¦: 5ç§’ä»¥å†…

### 3.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶
- **ãƒ‡ãƒ¼ã‚¿ä¿è­·**: GDPRãƒ»å€‹äººæƒ…å ±ä¿è­·æ³•æº–æ‹ 
- **é€šä¿¡æš—å·åŒ–**: HTTPS/TLS 1.3
- **èªè¨¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: JWT + ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³
- **AI API ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: API ã‚­ãƒ¼ç®¡ç†ã€ä½¿ç”¨é‡åˆ¶é™

### 3.3 ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£è¦ä»¶
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‹¡å¼µ**: 10,000ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ã§å¯¾å¿œ
- **è¨ºæ–­ãƒ‡ãƒ¼ã‚¿**: 100ä¸‡ä»¶ã®è¨ºæ–­çµæœå‡¦ç†
- **AI API ä½¿ç”¨é‡**: æœˆé–“100ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯¾å¿œ
- **å¤šè¨€èªå¯¾å¿œ**: æ—¥æœ¬èªãƒ»è‹±èªï¼ˆæ—¢å­˜ï¼‰+ è¿½åŠ è¨€èª

### 3.4 ã‚³ã‚¹ãƒˆç®¡ç†è¦ä»¶
- **AI API ã‚³ã‚¹ãƒˆ**: æœˆé¡$1,000ä»¥ä¸‹
- **ä½¿ç”¨é‡ç›£è¦–**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä½¿ç”¨é‡è¿½è·¡
- **è‡ªå‹•åˆ¶é™**: äºˆç®—è¶…éæ™‚ã®è‡ªå‹•åœæ­¢

## 4. æŠ€è¡“è¦ä»¶ï¼ˆæ‹¡å¼µï¼‰

### 4.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
```typescript
// æ—¢å­˜æŠ€è¡“ + ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æ‹¡å¼µ
{
  "core": {
    "react": "18.3.1",
    "typescript": "5.5.3", 
    "vite": "5.4.2"
  },
  "state": {
    "zustand": "^4.5.0",
    "react-query": "^5.0.0"
  },
  "personalization": { // æ–°è¦è¿½åŠ 
    "ai-sdk": "^3.0.0",
    "charts": "recharts@^2.8.0",
    "animations": "framer-motion@^11.0.0"
  },
  "forms": {
    "react-hook-form": "^7.50.0",
    "zod": "^3.22.0"
  }
}
```

### 4.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
```typescript
// Supabase + AIçµ±åˆ
{
  "backend": {
    "supabase": "^2.39.0",
    "supabase-js": "^2.39.0"
  },
  "ai_integration": { // æ–°è¦è¿½åŠ 
    "anthropic": "^0.24.0", // Claude
    "google-ai": "^0.6.0",  // Gemini
    "openai": "^4.20.0"     // å°†æ¥å¯¾å¿œ
  },
  "database": {
    "postgresql": "Supabase managed"
  },
  "caching": {
    "redis": "Upstash Redis" // AIå¿œç­”ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç”¨
  }
}
```

### 4.3 å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æº
- **æ±ºæ¸ˆ**: Stripe
- **AI**: Claude API, Gemini API
- **å‹•ç”»**: Vimeo/YouTube API
- **é€šçŸ¥**: SendGrid/Twilio
- **ç›£è¦–**: Sentry
- **åˆ†æ**: Google Analytics 4
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Upstash Redis ï¼ˆæ–°è¦è¿½åŠ ï¼‰

## 5. ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆï¼ˆæ‹¡å¼µï¼‰

### 5.1 ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦ï¼‰
```sql
-- è¨ºæ–­ãƒ†ã‚¹ãƒˆ
CREATE TABLE diagnostic_tests (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    questions JSONB NOT NULL,
    version INTEGER DEFAULT 1,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- è¨ºæ–­çµæœ
CREATE TABLE user_diagnostics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    test_id UUID REFERENCES diagnostic_tests(id),
    answers JSONB NOT NULL,
    raw_scores JSONB,
    ai_analysis JSONB, -- Phase 2ã§è¿½åŠ 
    completed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, test_id)
);

-- å­¦ç¿’è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
CREATE TABLE user_learning_profiles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) UNIQUE,
    learning_style VARCHAR(50),
    difficulty_preference VARCHAR(50),
    pace_preference VARCHAR(50),
    interest_areas TEXT[],
    skill_levels JSONB,
    personality_traits JSONB,
    motivation_factors TEXT[],
    ai_insights JSONB, -- Phase 2ã§è¿½åŠ 
    last_updated TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å€‹åˆ¥ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ 
CREATE TABLE personalized_curricula (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    profile_id UUID REFERENCES user_learning_profiles(id),
    curriculum_data JSONB NOT NULL,
    generation_method VARCHAR(50) DEFAULT 'template',
    ai_rationale TEXT,
    estimated_duration_weeks INTEGER,
    difficulty_progression JSONB,
    checkpoint_milestones JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AIä½¿ç”¨é‡è¿½è·¡ï¼ˆPhase 2ã§è¿½åŠ ï¼‰
CREATE TABLE ai_usage_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    provider VARCHAR(50) NOT NULL,
    usage_type VARCHAR(100),
    tokens_used INTEGER,
    cost_usd DECIMAL(10,4),
    date DATE DEFAULT CURRENT_DATE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- AIå¿œç­”ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆPhase 2ã§è¿½åŠ ï¼‰
CREATE TABLE ai_response_cache (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    prompt_hash VARCHAR(64) UNIQUE,
    provider VARCHAR(50),
    response JSONB,
    hit_count INTEGER DEFAULT 1,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE
);
```

### 5.2 æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ‹¡å¼µ
```sql
-- æ—¢å­˜ã®user_profilesãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ 
ALTER TABLE user_profiles ADD COLUMN learning_profile_id UUID REFERENCES user_learning_profiles(id);
ALTER TABLE user_profiles ADD COLUMN personalization_completed BOOLEAN DEFAULT false;

-- æ—¢å­˜ã®coursesãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ   
ALTER TABLE courses ADD COLUMN personalization_compatible BOOLEAN DEFAULT true;
ALTER TABLE courses ADD COLUMN skill_requirements JSONB;
ALTER TABLE courses ADD COLUMN learning_style_weights JSONB;

-- æ—¢å­˜ã®lesson_progressãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ 
ALTER TABLE lesson_progress ADD COLUMN engagement_metrics JSONB;
ALTER TABLE lesson_progress ADD COLUMN ai_recommendations JSONB;
ALTER TABLE lesson_progress ADD COLUMN difficulty_adjustment DECIMAL(3,2) DEFAULT 1.0;
```

## 6. APIè¨­è¨ˆï¼ˆæ‹¡å¼µï¼‰

### 6.1 ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³APIï¼ˆæ–°è¦ï¼‰
```typescript
// è¨ºæ–­ãƒ†ã‚¹ãƒˆé–¢é€£
GET /api/diagnostic/tests/latest          // æœ€æ–°ã®è¨ºæ–­ãƒ†ã‚¹ãƒˆå–å¾—
POST /api/diagnostic/submit               // è¨ºæ–­ãƒ†ã‚¹ãƒˆæå‡º
GET /api/diagnostic/results/:userId      // è¨ºæ–­çµæœå–å¾—

// ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
GET /api/personalization/profile/:userId       // å­¦ç¿’ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—
PUT /api/personalization/profile/:userId       // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°
POST /api/personalization/generate-curriculum  // ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ç”Ÿæˆ

// AIçµ±åˆï¼ˆPhase 2ä»¥é™ï¼‰
POST /api/ai/analyze-profile              // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«AIåˆ†æ
POST /api/ai/generate-curriculum          // AI ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ç”Ÿæˆ
POST /api/ai/chat                         // AIè³ªå•å¿œç­”
GET /api/ai/usage-stats                   // AIä½¿ç”¨çµ±è¨ˆ
```

### 6.2 é©å¿œçš„å­¦ç¿’APIï¼ˆæ‹¡å¼µï¼‰
```typescript
// æ—¢å­˜é€²æ—API + ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æ‹¡å¼µ
GET /api/progress/adaptive/:userId        // é©å¿œçš„é€²æ—å–å¾—
POST /api/progress/update-engagement      // ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆæ›´æ–°
GET /api/progress/predictions/:userId     // å­¦ç¿’äºˆæ¸¬å–å¾—
POST /api/progress/adjust-difficulty      // é›£æ˜“åº¦èª¿æ•´
```

## 7. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆï¼ˆæ‹¡å¼µï¼‰

### 7.1 ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼
- **è¨ºæ–­ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–**: æ©Ÿå¯†ãƒ¬ãƒ™ãƒ«ã®è¨ºæ–­çµæœ
- **AIåˆ†æãƒ‡ãƒ¼ã‚¿åŒ¿ååŒ–**: å€‹äººç‰¹å®šä¸å¯èƒ½ãªå½¢ã§ã®åˆ†æ
- **ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åŒæ„ç®¡ç†**: è©³ç´°åˆ†æã¸ã®åŒæ„å–å¾—

### 7.2 AI API ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **API ã‚­ãƒ¼ç®¡ç†**: Supabase Secrets ã§ã®å®‰å…¨ãªç®¡ç†
- **ä½¿ç”¨é‡åˆ¶é™**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»æ—¥æ¬¡ãƒ»æœˆæ¬¡åˆ¶é™
- **ç•°å¸¸æ¤œçŸ¥**: ä¸æ­£ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç›£è¦–

## 8. é‹ç”¨è¦ä»¶ï¼ˆæ‹¡å¼µï¼‰

### 8.1 ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
- **åŸºæœ¬ç›£è¦–**: APMã€ãƒ­ã‚°ç®¡ç†ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **AIç›£è¦–**: APIä½¿ç”¨é‡ã€å¿œç­”æ™‚é–“ã€ã‚¨ãƒ©ãƒ¼ç‡
- **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ç›£è¦–**: è¨ºæ–­å®Œäº†ç‡ã€ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ç”ŸæˆæˆåŠŸç‡

### 8.2 ãƒ‡ãƒ¼ã‚¿åˆ†æ
- **å­¦ç¿’åˆ†æ**: å€‹äººãƒ»å…¨ä½“ã®å­¦ç¿’ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
- **ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ**: A/Bãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹åŠ¹æœæ¸¬å®š
- **AIç²¾åº¦æ”¹å–„**: æ¨è–¦ç²¾åº¦ãƒ»æº€è¶³åº¦ã®ç¶™ç¶šæ”¹å–„

## 9. é–‹ç™ºè¨ˆç”»ï¼ˆä¿®æ­£ç‰ˆï¼‰

### Phase 1: ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºåŸºç›¤ï¼ˆ4é€±é–“ï¼‰
- **Week 1-2**: èªè¨¼ãƒ»åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ  + è¨ºæ–­ãƒ†ã‚¹ãƒˆDBæ§‹ç¯‰
- **Week 3-4**: 30å•è¨ºæ–­ãƒ†ã‚¹ãƒˆå®Ÿè£… + åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ

### Phase 2: AIçµ±åˆï¼ˆ6é€±é–“ï¼‰  
- **Week 5-7**: Claude/Gemini APIçµ±åˆ + AIåˆ†ææ©Ÿèƒ½
- **Week 8-10**: AIç”Ÿæˆã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ  + é©å¿œçš„æ¨è–¦

### Phase 3: é«˜åº¦ãªAIæ©Ÿèƒ½ï¼ˆ4é€±é–“ä»¥é™ï¼‰
- **Week 11-12**: äºˆæ¸¬çš„å­¦ç¿’æ”¯æ´
- **Week 13-14**: è‡ªç„¶è¨€èªå¯¾è©±ã‚·ã‚¹ãƒ†ãƒ 

### Phase 4: ãã®ä»–æ©Ÿèƒ½ï¼ˆä¸¦è¡Œé–‹ç™ºï¼‰
- ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ©Ÿèƒ½
- æ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ 
- ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**ç·é–‹ç™ºæœŸé–“**: 18é€±é–“ï¼ˆç´„4.5ãƒ¶æœˆï¼‰
**æ¨å®šã‚³ã‚¹ãƒˆ**: 400-600ä¸‡å††ï¼ˆAIæ©Ÿèƒ½è¾¼ã¿ï¼‰

## 10. æˆåŠŸæŒ‡æ¨™ï¼ˆKPIï¼‰

### 10.1 ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æŒ‡æ¨™
- **è¨ºæ–­å®Œäº†ç‡**: 80%ä»¥ä¸Š
- **ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ æº€è¶³åº¦**: 4.5/5.0ä»¥ä¸Š
- **å­¦ç¿’ç¶™ç¶šç‡**: å¾“æ¥æ¯”150%å‘ä¸Š
- **ç›®æ¨™é”æˆç‡**: 60%ä»¥ä¸Š

### 10.2 AIæ©Ÿèƒ½æŒ‡æ¨™ï¼ˆPhase 2ä»¥é™ï¼‰
- **AIæ¨è–¦ç²¾åº¦**: 85%ä»¥ä¸Š
- **è³ªå•å¿œç­”æº€è¶³åº¦**: 4.0/5.0ä»¥ä¸Š
- **ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ç”ŸæˆæˆåŠŸç‡**: 95%ä»¥ä¸Š
- **AI API ã‚³ã‚¹ãƒˆåŠ¹ç‡**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å½“ãŸã‚Šæœˆé¡$2ä»¥ä¸‹

### 10.3 ãƒ“ã‚¸ãƒã‚¹æŒ‡æ¨™
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç²å¾—**: æœˆé–“200åæ–°è¦ç™»éŒ²
- **åç›Š**: æœˆé–“500ä¸‡å††ï¼ˆ1å¹´å¾Œç›®æ¨™ï¼‰
- **ãƒãƒ£ãƒ¼ãƒ³ç‡**: 5%ä»¥ä¸‹
- **NPS**: 70ä»¥ä¸Š